<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Emile DEFEVER Portfolio - Fury</title>
  <link rel="stylesheet" href="styles.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet"/>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
  <!-- Overlay pour mobile -->
  <div id="mobile-overlay" class="mobile-overlay">
    <div class="overlay-content">
      <div class="overlay-icon">📱</div>
      <h2>The mobile version is under construction!</h2>
      <p>For now, please visit a larger screen to fully enjoy the content !</p>
    </div>
  </div>

  <div class="iframe-container">
    <iframe 
      src="https://upbeat-i12evqci.peachworlds.com/"
      frameborder="0"
      allowfullscreen
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
      loading="lazy"
      sandbox="allow-same-origin allow-scripts allow-popups allow-forms allow-top-navigation-by-user-activation">
    </iframe>
  </div>

  <!-- Script analytics Firebase -->
  <script>
    // 1) Config Firebase (même projet que l’index)
    const firebaseConfig = {
      apiKey: "AIzaSyBD-K2F6uv_TOpRSxiRgWjVDvJ_PLSYKOQ",
      authDomain: "portfolio-4b510.firebaseapp.com",
      projectId: "portfolio-4b510",
      storageBucket: "portfolio-4b510.firebasestorage.app",
      messagingSenderId: "723553154253",
      appId: "1:723553154253:web:60b76cd8c2f13c617ae584",
      measurementId: "G-639Q6CLY3G"
    };

    // 2) Init (avec garde-fou si d’autres scripts init Firebase)
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.firestore();

    // 3) Infos session / page
    const sessionId = (crypto.randomUUID && crypto.randomUUID()) || Math.random().toString(36).substring(2, 12);
    const page = location.pathname || "/fury.html";
    const siteId = "fury";                 // <- tag pratique pour filtrer par “site”
    const referrer = document.referrer || null;

    // 4) Mesure du temps visible
    let visibleSince = document.visibilityState === 'visible' ? performance.now() : 0;
    let activeMs = 0;

    async function flush(eventType){
      if (visibleSince) {
        activeMs += performance.now() - visibleSince;
        visibleSince = 0;
      }
      try {
        await db.collection("pageAnalytics").add({
          siteId,                // permet de filtrer Fury vs index
          sessionId,
          page,
          event: eventType,      // "load" | "hidden" | "unload"
          activeMs: Math.round(activeMs),
          ts: new Date().toISOString(),
          referrer
        });
      } catch (e) {
        console.error("Erreur Firestore:", e);
      }
    }

    document.addEventListener("visibilitychange", () => {
      if (document.visibilityState === 'hidden') {
        flush("hidden");
      } else {
        visibleSince = performance.now();
      }
    });

    window.addEventListener("beforeunload", () => flush("unload"));

    // 5) Enregistrer l’entrée
    flush("load");
  </script>

  <!-- Ton JS habituel -->
  <script src="script.js"></script>
</body>
</html>
